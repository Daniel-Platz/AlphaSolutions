<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Projects</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
</head>
<body>
<header class="header">
    <a th:href="@{/projects}">
        <img th:src="@{/images/logo.png}" alt="Logo" class="logo">
    </a>

    <div class="header-right">
        <div class="user-info" th:if="${session.employee != null}">
            <span th:text="${session.employee.firstname + ' ' + session.employee.lastname}"></span>
            <span th:text="'(' + ${session.role} + ')'"></span>
            <a href="/logout" class="logout-btn">Logout</a>
        </div>
        <button class="circle-btn"></button>
    </div>
</header>


<main>
    <div th:if="${session.forcePasswordChange}">
        <div style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); z-index: 9999;">
            <div style="background: white; width: 400px; margin: 10% auto; padding: 20px; border-radius: 10px;">
                <h2>Skift kodeord</h2>
                <p>Af sikkerhedshensyn skal du Ã¦ndre dit kodeord.</p>

                <form method="post" action="/change-password">
                    <label for="newPassword">Nyt kodeord:</label><br>
                    <input type="password" name="newPassword" id="newPassword" required><br><br>

                    <label for="confirmPassword">Gentag kodeord:</label><br>
                    <input type="password" name="confirmPassword" id="confirmPassword" required><br><br>

                    <div th:if="${error}" style="color:red;" th:text="${error}"></div>

                    <button type="submit">Skift kodeord</button>
                </form>
            </div>
        </div>
    </div>

    <h1>Projects</h1>

    <div th:if="${role == 'ADMIN'}">
        <a href="/admin/employees" class="button">Manage Employees</a>
        <a href="/admin/employees/list" class="button">View All Employees</a>
    </div>

    <!-- Add Project Button (only for ADMIN and PROJECT_MANAGER) -->
    <div th:if="${role == 'ADMIN' || role == 'PROJECT_MANAGER'}">
        <a href="/projects/create" class="button">Add New Project</a>
    </div>

    <!-- Projects List -->
    <div class="projects-list">
        <table>
            <thead>
            <tr>
                <th>Project Name</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="project : ${projects}">
                <td th:text="${project.projectName}"></td>
                <td th:text="${project.projectStartDate != null ? #dates.format(project.projectStartDate, 'yyyy-MM-dd') : ''}"></td>
                <td th:text="${project.projectEndDate != null ? #dates.format(project.projectEndDate, 'yyyy-MM-dd') : ''}"></td>
                <td>
                    <a th:href="@{/projects/{id}(id=${project.projectId})}" class="button">View</a>

                    <!-- Edit/Delete buttons (only for ADMIN and PROJECT_MANAGER) -->
                    <span th:if="${role == 'ADMIN' || role == 'PROJECT_MANAGER'}">
                                <a th:href="@{/projects/{id}/edit(id=${project.projectId})}" class="button">Edit</a>
                                <a th:href="@{/projects/{id}/delete(id=${project.projectId})}" class="button"
                                   onclick="return confirm('Are you sure you want to delete this project?')">Delete</a>
                            </span>
                </td>
            </tr>
            <tr th:if="${projects.empty}">
                <td colspan="4">No projects found</td>
            </tr>
            </tbody>
        </table>
    </div>
</main>
</body>
</html>