<!DOCTYPE html>
<html lang="da" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Opgave Styring</title>
</head>
<body>
<div th:replace="~{fragments/header :: siteHeader}"></div>

<main class="container">
  <!-- Delprojekt header sektion -->
  <section class="subproject-header">
    <h1 class="title" th:text="${subProject.subProjectName}">Del-Projekt Navn</h1>

    <div class="subproject-details">
      <p class="description" th:text="${subProject.subProjectDescription}">Del-Projekt Beskrivelse</p>
      <div class="date-container">
        <div class="date-item"><strong>Start Dato:</strong> <span th:text="${subProject.subProjectStartDate != null ? #temporals.format(subProject.subProjectStartDate, 'yyyy-MM-dd') : 'Ikke angivet'}">-</span></div>
        <div class="date-item"><strong>Slut Dato:</strong> <span th:text="${subProject.subProjectEndDate != null ? #temporals.format(subProject.subProjectEndDate, 'yyyy-MM-dd') : 'Ikke angivet'}">-</span></div>
      </div>
    </div>
  </section>

  <!-- Statistik sektion -->
  <section class="statistics-section">
    <h2 class="section-title">Statistik</h2>
    <div class="statistics-container">
      <div class="stat-item">
        <span class="stat-label">Total Estimerede Timer:</span>
        <span class="stat-value" th:text="${totalEstimatedHours ?: 0}">0</span> timer
      </div>
      <div class="stat-item">
        <span class="stat-label">Faktiske Timer:</span>
        <span class="stat-value" th:text="${actualHours ?: 0}">0</span> timer
      </div>
      <div class="stat-item">
        <span class="stat-label">Timer Brugt:</span>
        <span class="stat-value" th:text="${hoursUsedPercentage ?: 0}">0</span>%
      </div>
    </div>
  </section>

  <!-- Actions sektion -->
  <section class="actions-section">
    <div class="admin-actions" th:if="${role == 'ADMIN' || role == 'PROJECT_MANAGER'}">
      <a class="btn btn-primary" th:href="@{/dashboard/{projectId}/projectOverview/{subProjectId}/subProjectOverview/addTask(projectId=${projectId},subProjectId=${subProjectId})}">
        <i class="icon-plus"></i> Tilføj Ny Opgave
      </a>
    </div>
  </section>

  <!-- Opgave tabel sektion -->
  <section class="tasks-section">
    <h2 class="section-title">Opgaver</h2>
    <div class="table-responsive">
      <table class="task-table">
        <thead>
        <tr>
          <th class="task-name-col">Opgave Navn</th>
          <th class="hours-col">Estimeret Tid</th>
          <th class="hours-col">Tid Brugt</th>
          <th class="date-col">Deadline</th>
          <th class="status-col">Status</th>
          <th class="actions-col">Handlinger</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="task : ${tasks}" class="task-row">
          <td th:text="${task.taskName}" class="task-name"></td>
          <td th:text="${task.taskEstimatedHours != null ? task.taskEstimatedHours : '0'}" class="hours-data"></td>
          <td class="hours-data">-</td> <!-- Placeholder for task actual hours -->
          <td th:text="${task.taskEndDate != null ? #temporals.format(task.taskEndDate, 'yyyy-MM-dd') : ''}" class="date-data"></td>
          <td th:text="${task.taskStatus}" class="status-data"></td>
          <td class="actions-data">
            <div class="action-buttons">
              <a class="btn btn-view" th:href="@{/dashboard/{projectId}/projectOverview/{subProjectId}/subProjectOverview/{taskId}/taskOverview(projectId=${projectId},subProjectId=${subProjectId}, taskId=${task.taskId})}">Vis</a>

              <div class="admin-buttons" th:if="${role == 'ADMIN' || role == 'PROJECT_MANAGER'}">
                <a class="btn btn-edit" th:href="@{/dashboard/{projectId}/projectOverview/{subProjectId}/subProjectOverview/{taskId}/taskOverview/editTask(projectId=${projectId}, subProjectId=${subProjectId}, taskId=${task.taskId})}">Rediger</a>
                <a class="btn btn-delete" th:href="@{/dashboard/{projectId}/projectOverview/{subProjectId}/subProjectOverview/{taskId}/taskOverview/deleteTask(projectId=${projectId}, subProjectId=${subProjectId}, taskId=${task.taskId})}"
                   onclick="return confirm('Er du sikker på at du vil slette denne opgave?')">Slet</a>
              </div>
            </div>
          </td>
        </tr>
        <tr th:if="${tasks.empty}" class="empty-row">
          <td colspan="6" class="empty-message">Ingen opgaver fundet</td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Navigation sektion -->
  <section class="navigation-section">
    <div class="nav-buttons">
      <a th:href="@{/dashboard/{projectId}/projectOverview(projectId=${projectId})}" class="btn btn-back">
        <i class="icon-arrow-left"></i> Tilbage til Projekt Oversigt
      </a>
    </div>
  </section>
</main>
</body>
</html>